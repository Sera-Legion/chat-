<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Веб-Чат</title>
    <style>
        :root {
            --accent-color: #6a1b9a;
            --accent-dark: #4a148c;
            --bg-color: #0f0f1a;
            --message-user: linear-gradient(135deg, #6a1b9a, #5a0d8a);
            --message-bot: linear-gradient(135deg, #252538, #1e1e2e);
            --text-color: #f0f0f0;
            --input-bg: rgba(255, 255, 255, 0.05);
            --messages-bg: #0a0a12;
            --header-text: white;
            --time-color: rgba(255, 255, 255, 0.4);
            --chat-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
            --border-color: rgba(74, 20, 140, 0.3);
        }

        .light-theme {
            --accent-color: #9c27b0;
            --accent-dark: #7b1fa2;
            --bg-color: #f5f5f5;
            --message-user: linear-gradient(135deg, #9c27b0, #8e24aa);
            --message-bot: linear-gradient(135deg, #e0e0e0, #f5f5f5);
            --text-color: #333333;
            --input-bg: rgba(0, 0, 0, 0.05);
            --messages-bg: #ffffff;
            --header-text: white;
            --time-color: rgba(0, 0, 0, 0.5);
            --chat-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
            --border-color: rgba(156, 39, 176, 0.3);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(circle at center, #0c0c1a 0%, #070710 100%);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-color);
            transition: background 0.5s ease, color 0.3s ease;
        }

        .light-theme body {
            background: radial-gradient(circle at center, #e0e0e0 0%, #f5f5f5 100%);
        }

        .chat-container {
            width: 90%;
            max-width: 600px;
            height: 85vh;
            background-color: var(--bg-color);
            border-radius: 16px;
            box-shadow: var(--chat-shadow),
                        inset 0 0 0 1px rgba(255, 255, 255, 0.03);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--border-color);
            position: relative;
            transition: all 0.5s ease;
        }

        .light-theme .chat-container {
            box-shadow: var(--chat-shadow),
                        inset 0 0 0 1px rgba(0, 0, 0, 0.05);
        }

        .chat-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 30%, rgba(106, 27, 154, 0.1) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(106, 27, 154, 0.1) 0%, transparent 25%);
            opacity: 0.5;
            z-index: 0;
            animation: pulse 15s infinite alternate;
        }

        .light-theme .chat-container::before {
            background:
                radial-gradient(circle at 20% 30%, rgba(156, 39, 176, 0.1) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(156, 39, 176, 0.1) 0%, transparent 25%);
        }

        @keyframes pulse {
            0% { opacity: 0.3; }
            50% { opacity: 0.6; }
            100% { opacity: 0.3; }
        }

        .chat-header {
            background: linear-gradient(135deg, var(--accent-dark), var(--accent-color));
            color: var(--header-text);
            padding: 18px 20px;
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            z-index: 1;
            transition: all 0.5s ease;
        }

        .light-theme .chat-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .chat-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, rgba(106, 27, 154, 0), var(--accent-color), rgba(106, 27, 154, 0));
            transition: all 0.5s ease;
        }

        .light-theme .chat-header::after {
            background: linear-gradient(90deg, rgba(156, 39, 176, 0), var(--accent-color), rgba(156, 39, 176, 0));
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: var(--messages-bg);
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) var(--messages-bg);
            position: relative;
            z-index: 1;
            transition: background-color 0.5s ease;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: var(--messages-bg);
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--accent-color);
            border-radius: 3px;
        }

        .message {
            margin-bottom: 15px;
            padding: 14px 18px;
            border-radius: 20px;
            max-width: 75%;
            word-wrap: break-word;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.5s ease;
        }

        .message:hover {
            transform: scale(1.02);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .user-message {
            background: var(--message-user);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 8px;
            box-shadow: 0 2px 6px rgba(106, 27, 154, 0.3);
            transition: all 0.5s ease;
        }

        .light-theme .user-message {
            box-shadow: 0 2px 6px rgba(156, 39, 176, 0.3);
        }

        .other-message {
            background: var(--message-bot);
            color: var(--text-color);
            margin-right: auto;
            border-bottom-left-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.5s ease;
        }

        .dice-message {
            background: var(--message-bot);
            color: var(--text-color);
            margin: 15px auto;
            border-radius: 20px;
            text-align: center;
            padding: 20px;
            max-width: 200px;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .help-message {
            background: var(--message-bot);
            color: var(--text-color);
            margin: 15px auto;
            border-radius: 20px;
            padding: 20px;
            max-width: 80%;
            font-size: 1em;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .coin-message {
            background: var(--message-bot);
            color: var(--text-color);
            margin: 15px auto;
            border-radius: 20px;
            text-align: center;
            padding: 20px;
            max-width: 80%;
            font-size: 1em;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .help-title {
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.2em;
        }

        .help-command {
            margin: 8px 0;
            padding-left: 15px;
            position: relative;
        }

        .help-command::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--accent-color);
        }

        .coin-image {
            max-width: 100px;
            margin: 10px auto;
            display: block;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .coin-result {
            font-size: 1.5em;
            margin: 10px 0;
            color: var(--accent-color);
            font-weight: bold;
        }

        .dice-result {
            font-size: 2em;
            margin: 10px 0;
            color: var(--accent-color);
            text-shadow: 0 0 5px rgba(106, 27, 154, 0.3);
        }

        .light-theme .dice-result {
            text-shadow: 0 0 5px rgba(156, 39, 176, 0.3);
        }

        .message-time {
            display: block;
            font-size: 0.7em;
            color: var(--time-color);
            text-align: right;
            margin-top: 6px;
            letter-spacing: 0.3px;
            transition: color 0.5s ease;
        }

        .chat-input {
            display: flex;
            padding: 16px;
            background-color: #131320;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            z-index: 1;
            transition: all 0.5s ease;
        }

        .light-theme .chat-input {
            background-color: #f0f0f0;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .chat-input::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, rgba(106, 27, 154, 0), var(--accent-color), rgba(106, 27, 154, 0));
            transition: all 0.5s ease;
        }

        #message-input {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 30px;
            outline: none;
            font-size: 1em;
            transition: all 0.3s;
            background-color: var(--input-bg);
            color: var(--text-color);
            backdrop-filter: blur(5px);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
            z-index: 1;
        }

        .light-theme #message-input {
            box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
        }

        #message-input:focus {
            background-color: rgba(255, 255, 255, 0.08);
            box-shadow: inset 0 0 0 1px rgba(106, 27, 154, 0.5),
                        0 0 0 3px rgba(106, 27, 154, 0.1);
        }

        .light-theme #message-input:focus {
            background-color: rgba(0, 0, 0, 0.08);
            box-shadow: inset 0 0 0 1px rgba(156, 39, 176, 0.5),
                        0 0 0 3px rgba(156, 39, 176, 0.1);
        }

        #message-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
            transition: opacity 0.3s;
        }

        .light-theme #message-input::placeholder {
            color: rgba(0, 0, 0, 0.3);
        }

        #message-input:focus::placeholder {
            opacity: 0.5;
        }

        #send-button {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
            color: white;
            border: none;
            border-radius: 50%;
            width: 52px;
            height: 52px;
            margin-left: 12px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 8px rgba(106, 27, 154, 0.3);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .light-theme #send-button {
            box-shadow: 0 2px 8px rgba(156, 39, 176, 0.3);
        }

        #send-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        #send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(106, 27, 154, 0.4);
        }

        .light-theme #send-button:hover {
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.4);
        }

        #send-button:hover::after {
            opacity: 1;
        }

        #send-button:active {
            transform: scale(0.96);
        }

        .typing-indicator {
            font-style: italic;
            color: rgba(160, 160, 160, 0.7);
            padding: 5px 20px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            transition: color 0.5s ease;
        }

        .light-theme .typing-indicator {
            color: rgba(100, 100, 100, 0.7);
        }

        .typing-dots {
            display: flex;
            margin-left: 8px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
            transition: background-color 0.5s ease;
        }

        .light-theme .typing-dot {
            background-color: rgba(0, 0, 0, 0.4);
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .censored {
            color: #ff4d4d;
            font-weight: bold;
            text-shadow: 0 0 4px rgba(255, 77, 77, 0.3);
            cursor: help;
            position: relative;
        }

        .censored::after {
            content: 'Цензура';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #ff4d4d;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            white-space: nowrap;
        }

        .censored:hover::after {
            opacity: 1;
        }

        .parallax-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .parallax-item {
            position: absolute;
            background: rgba(106, 27, 154, 0.1);
            border-radius: 50%;
            transition: background 0.5s ease;
        }

        .light-theme .parallax-item {
            background: rgba(156, 39, 176, 0.1);
        }

        .message-icon {
            display: inline-block;
            margin-right: 8px;
            font-size: 1.2em;
            vertical-align: middle;
        }

        @keyframes highlight {
            0% { box-shadow: 0 0 0 0 rgba(106, 27, 154, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(106, 27, 154, 0); }
            100% { box-shadow: 0 0 0 0 rgba(106, 27, 154, 0); }
        }

        .light-theme .new-message {
            animation: highlight 1.5s ease-out;
        }

        .new-message {
            animation: highlight 1.5s ease-out;
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 2;
            transition: all 0.3s;
        }

        .light-theme .theme-toggle {
            background: rgba(255, 255, 255, 0.3);
            color: #333;
        }

        .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.5);
            transform: rotate(30deg);
        }

        .light-theme .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        @media (prefers-color-scheme: light) {
            body:not(.light-theme):not(.dark-theme) {
                --accent-color: #9c27b0;
                --accent-dark: #7b1fa2;
                --bg-color: #f5f5f5;
                --message-user: linear-gradient(135deg, #9c27b0, #8e24aa);
                --message-bot: linear-gradient(135deg, #e0e0e0, #f5f5f5);
                --text-color: #333333;
                --input-bg: rgba(0, 0, 0, 0.05);
                --messages-bg: #ffffff;
                --header-text: white;
                --time-color: rgba(0, 0, 0, 0.5);
                --chat-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
                --border-color: rgba(156, 39, 176, 0.3);
            }

            body:not(.light-theme):not(.dark-theme) {
                background: radial-gradient(circle at center, #e0e0e0 0%, #f5f5f5 100%);
            }

            body:not(.light-theme):not(.dark-theme) .theme-toggle {
                background: rgba(255, 255, 255, 0.3);
                color: #333;
            }
        }
        .fact-message {
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    border-left: 4px solid var(--accent-color);
    padding: 12px 15px;
    margin: 10px 0;
    border-radius: 0 12px 12px 0;
}

.fact-message strong {
    color: var(--accent-color);
}


    </style>
</head>
<body>
    <div class="chat-container">
        <div class="parallax-bg" id="parallax-bg"></div>

        <button class="theme-toggle" id="theme-toggle">☀️</button>

        <div class="chat-header">
            Чач
        </div>

        <div class="chat-messages" id="chat-messages">
            <!-- Сообщения будут появляться здесь -->
        </div>

        <div class="chat-input">
            <input type="text" id="message-input" placeholder="Напишите сообщение..." autocomplete="off">
            <button id="send-button">➤</button>
        </div>
    </div>

    <script>
    const chatMessages = document.getElementById('chat-messages');
const messageInput = document.getElementById('message-input');
const sendButton = document.getElementById('send-button');
const themeToggle = document.getElementById('theme-toggle');
const parallaxBg = document.getElementById('parallax-bg');
const body = document.body;

// Проверяем сохраненную тему в localStorage
const savedTheme = localStorage.getItem('chat-theme');
if (savedTheme) {
  body.classList.add(savedTheme);
  updateThemeButton();
} else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
  body.classList.add('light-theme');
  updateThemeButton();
}

// Создаем эффект параллакса
function createParallax() {
  for (let i = 0; i < 15; i++) {
      const item = document.createElement('div');
      item.classList.add('parallax-item');

      const size = Math.random() * 100 + 50;
      const posX = Math.random() * 100;
      const posY = Math.random() * 100;
      const opacity = Math.random() * 0.1 + 0.05;
      const delay = Math.random() * 5;

      item.style.width = `${size}px`;
      item.style.height = `${size}px`;
      item.style.left = `${posX}%`;
      item.style.top = `${posY}%`;
      item.style.opacity = opacity;
      item.style.animation = `pulse ${10 + delay}s infinite alternate`;

      parallaxBg.appendChild(item);
  }
}

// Обновляем иконку кнопки переключения темы
function updateThemeButton() {
  if (body.classList.contains('light-theme')) {
      themeToggle.textContent = '🌙';
  } else {
      themeToggle.textContent = '☀️';
  }
}

// Слова для цензуры
const censoredWords = ['гитлер', 'суицид', 'ересь', 'каляска'];



// Функция для цензуры сообщения с сохранением регистра
function censorMessage(message) {
  censoredWords.forEach(word => {
      const regex = new RegExp(word, 'gi');
      message = message.replace(regex, match => {
          return `<span class="censored" title="Цензура">[данные удалены]</span>`;
      });
  });
  return message;
}

// Функция для добавления сообщения в чат
function addMessage(content, isUser) {
  const messageDiv = document.createElement('div');
  messageDiv.classList.add('message');
  messageDiv.classList.add(isUser ? 'user-message' : 'other-message');
  messageDiv.classList.add('new-message');

  const icon = isUser ? '👤' : '🤖';
  const censoredContent = censorMessage(content);
  messageDiv.innerHTML = `
      <span class="message-icon">${icon}</span>
      ${censoredContent}
      <span class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
  `;

  chatMessages.appendChild(messageDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;

  setTimeout(() => {
      messageDiv.classList.remove('new-message');
  }, 1500);
}

// Функция для броска кубика
function rollDice() {
  const result = Math.floor(Math.random() * 6) + 1;

  const diceDiv = document.createElement('div');
  diceDiv.classList.add('message', 'dice-message', 'new-message');
  diceDiv.innerHTML = `
      <div>🎲 Бросок кубика:</div>
      <div class="dice-result">${result}</div>
      <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
  `;

  chatMessages.appendChild(diceDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;

  const diceResult = diceDiv.querySelector('.dice-result');
  let counter = 0;
  const interval = setInterval(() => {
      if (counter < 10) {
          diceResult.textContent = Math.floor(Math.random() * 6) + 1;
          counter++;
      } else {
          diceResult.textContent = result;
          clearInterval(interval);
          setTimeout(() => {
              diceDiv.classList.remove('new-message');
          }, 1500);
      }
  }, 100);
}


// Функция для подбрасывания монетки
function flipCoin() {
  const randomValue = Math.random() * 100;
  let result, resultText;

  if (randomValue < 49.5) {
      result = "орел";
      resultText = "Выпал орёл!";
  } else if (randomValue < 99) {
      result = "решка";
      resultText = "Выпала решка!";
  } else {
      result = "ребро";
      resultText = "Чудо! Монета встала на ребро!";
  }

  const coinDiv = document.createElement('div');
  coinDiv.classList.add('message', 'coin-message', 'new-message');
  coinDiv.innerHTML = `
      <div>🪙 Подбрасываем монетку...</div>
      <img src="img/drop.gif" class="coin-image" id="coin-image">
  `;

  chatMessages.appendChild(coinDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;

  setTimeout(() => {
      const coinImage = coinDiv.querySelector('#coin-image');
      if (result === "орел") {
          coinImage.src = "img/orelreshka.gif";
      } else if (result === "решка") {
          coinImage.src = "img/orelreshka.gif";
      } else {
          coinImage.src = "img/rebro.gif";
      }
      coinImage.style.width = "80px";

      setTimeout(() => {
          coinDiv.classList.remove('new-message');
      }, 2250);
      coinDiv.innerHTML += `
          <div class="coin-result">${resultText}</div>
          <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>`;
  }, 2750);
}

// Функция для обработки команды !глеб
function handleGlebCommand() {
  showTypingIndicator();
  setTimeout(() => {
      hideTypingIndicator();
      addMessage("Глебы идут нахуй!", false);
  }, 800 + Math.random() * 500);
}

// Локальная база фактов (250 штук)
const localFacts = [
    // Животные (1-10)
    "У кошек 32 мышцы в каждом ухе.",
    "Сердце креветки находится в голове.",
    "Улитки могут спать до 3 лет.",
    "Глаз страуса больше, чем его мозг.",
    "Муравьи никогда не спят.",
    "Бабочки пробуют еду ногами.",
    "Слоны - единственные животные, которые не умеют прыгать.",
    "У жирафа столько же шейных позвонков, сколько у человека - 7.",
    "Кровь кузнечика белого цвета.",
    "Пингвины могут подпрыгивать до 2 метров в высоту.",

    // Наука (11-20)
    "Венера - единственная планета, вращающаяся по часовой стрелке.",
    "Свету от Солнца до Земли требуется 8 минут 20 секунд.",
    "Человеческое тело светится в темноте, но свет слишком слаб для наших глаз.",
    "Водород - самый распространенный элемент во Вселенной.",
    "Алмазы могут гореть при высокой температуре.",
    "Желудочная кислота может растворить бритвенное лезвие.",
    "Человеческая ДНК на 50% идентична ДНК банана.",
    "В чайной ложке почвы больше микроорганизмов, чем людей на Земле.",
    "Океаны содержат 99% жизненного пространства на планете.",
    "Кислород на Земле производится в основном океаническими водорослями.",

    // История (21-30)
    "Клеопатра жила ближе к изобретению iPhone, чем к строительству пирамид.",
    "В 1830-х годах кетчуп продавался как лекарство.",
    "Первый компьютерный баг был реальным насекомым - мотыльком.",
    "В Древнем Египте фараоны брили головы, чтобы избежать вшей.",
    "Первый телефонный справочник содержал всего 50 имен.",
    "Винстон Черчилль родился в женском туалете во время бала.",
    "В 1923 году чемпион по бегу с препятствиями был дисквалифицирован за то, что прополз под барьерами.",
    "В Древнем Риме моча использовалась для чистки зубов.",
    "Первый космонавт Юрий Гагарин стал почетным членом племени майя в Гватемале.",
    "В 19 веке лоботомия считалась передовым методом лечения психических заболеваний.",

    // Человеческое тело (31-40)
    "Ваш желудок полностью обновляет свою слизистую каждые 3-4 дня.",
    "Человек производит около 25 000 литров слюны за жизнь.",
    "Ногти на руках растут в 4 раза быстрее, чем на ногах.",
    "Кости человека прочнее стали, если сравнивать одинаковый вес.",
    "Дети рождаются без коленных чашечек - они формируются к 2-3 годам.",
    "Язык - самая сильная мышца в теле относительно своего размера.",
    "Человек забывает 90% своих снов в течение 10 минут после пробуждения.",
    "За жизнь человек проходит расстояние, равное 5 экваторам Земли.",
    "Отпечатки языка уникальны, как и отпечатки пальцев.",
    "Человек может прожить без воды всего 3-5 дней.",

    // Еда (41-50)
    "Мед - единственная еда, которая не портится.",
    "Арахис - это не орех, а бобовое растение.",
    "Яблоки плавают в воде, потому что на 25% состоят из воздуха.",
    "Бананы радиоактивны из-за содержания калия-40.",
    "Шоколад был когда-то использован как валюта.",
    "Морковь изначально была фиолетовой.",
    "Виноград взрывается в микроволновке.",
    "Острый перец чили вызывает выделение эндорфинов, как при занятиях спортом.",
    "Кофе - второй по продаваемости товар в мире после нефти.",
    "Сыр - самый воруемый продукт в мире.",

    // Технологии (51-60)
    "Первый компьютер весил более 27 тонн.",
    "Пароль для ядерных ракет США в 1960-х годах был 00000000.",
    "Первый сайт в интернете до сих пор работает: info.cern.ch",
    "90% всех данных в мире было создано за последние 2 года.",
    "Первый жесткий диск в 1956 году хранил всего 5 МБ данных.",
    "QR-коды могут содержать до 4296 символов.",
    "Первый мобильный телефон стоил $4000 в 1983 году.",
    "В 1995 году только 1% мирового населения имел доступ к интернету.",
    "Google обрабатывает около 100 миллиардов поисковых запросов в месяц.",
    "Первый компьютерный вирус был создан в 1983 году.",

    // География (61-70)
    "В Сахаре иногда идет снег.",
    "В Канаде больше озер, чем во всем остальном мире вместе взятом.",
    "Россия имеет 11 часовых поясов.",
    "В Исландии нет комаров.",
    "Самое короткое название места - 'Å' в Швеции и Норвегии.",
    "Антарктида - самая большая пустыня в мире.",
    "На границе между США и Канадой есть город, разделенный пополам - Дерби Лайн.",
    "В Греции больше международных аэропортов, чем в любой другой стране Европы.",
    "В Японии более 50 000 человек старше 100 лет.",
    "В Венеции около 400 мостов - больше, чем в любом другом городе мира.",

    // Искусство (71-80)
    "Леонардо да Винчи писал 'Мону Лизу' 16 лет.",
    "Ван Гог продал только одну картину при жизни.",
    "Шекспир изобрел более 1700 слов английского языка.",
    "Первая камера требовала 8 часов экспозиции для одного снимка.",
    "Бетховен сочинял музыку, будучи полностью глухим.",
    "Первый фильм с CGI был создан в 1973 году.",
    "Самый дорогой музыкальный инструмент - скрипка Страдивари, проданная за $15.9 млн.",
    "'Унесенные ветром' - первый цветной фильм, получивший 'Оскар'.",
    "Эйфелева башня должна была быть временной постройкой.",
    "Первая фотография человека была сделана в 1838 году.",

    // Спорт (81-90)
    "Футбольные ворота изначально не имели перекладины.",
    "Олимпийские золотые медали на 92.5% состоят из серебра.",
    "Первый баскетбольный матч играли футбольным мячом.",
    "Шахматы признаны видом спорта в более чем 100 странах.",
    "Самый длинный теннисный матч длился 11 часов 5 минут.",
    "Гольф - единственный вид спорта, игравшийся на Луне.",
    "В бейсболе мяч может достигать скорости 160 км/ч.",
    "Первый марафонец умер после пробега.",
    "В 1900 году плавание с препятствиями было олимпийским видом спорта.",
    "Самый молодой олимпийский чемпион - 10-летний гребец из Франции (1900).",

    // Языки (91-100)
    "В английском языке больше всего слов - около 1 млн.",
    "Самое длинное слово в русском языке - 'превысокомногорассмотрительствующий' (35 букв).",
    "В гавайском алфавите всего 12 букв.",
    "'Almost' - самое длинное английское слово, где все буквы расположены в алфавитном порядке.",
    "В Южной Африке 11 официальных языков.",
    "Эсперанто - самый распространенный искусственный язык.",
    "В китайском языке около 50 000 иероглифов.",
    "Русский - самый распространенный язык в Европе по числу носителей.",
    "В арабском языке нет заглавных букв.",
    "Венгерский язык - один из самых сложных для изучения.",

    // Необычные факты (101-110)
    "Высота Эйфелевой башни может меняться на 15 см из-за температуры.",
    "В Швейцарии запрещено спускать воду в туалете после 10 вечера.",
    "В Японии продают арбузы квадратной формы.",
    "Вероятность быть убитым пробкой от шампанского выше, чем укушенным пауком.",
    "В Швеции есть отель изо льда, который перестраивают каждый год.",
    "В Непале пятница - официальный выходной.",
    "В Лас-Вегасе нет часов в казино.",
    "В Саудовской Аравии нет рек.",
    "Во Франции запрещено называть свиней Наполеон.",
    "В Исландии нет железных дорог.",

    // Космос (111-120)
    "На Луне есть памятник погибшим космонавтам - алюминиевая фигурка.",
    "В космосе царит полная тишина - звук не распространяется.",
    "На Венере сутки длиннее года.",
    "Солнце составляет 99.86% массы Солнечной системы.",
    "Если два куска металла соприкоснутся в космосе, они сольются.",
    "На Марсе закаты голубые.",
    "В космосе астронавты не могут плакать - слезы не стекают.",
    "Международная космическая станция видна с Земли невооруженным глазом.",
    "В космосе человек становится выше на 5-8 см.",
    "На Луне есть следы астронавтов, которые сохранятся миллионы лет.",

    // Медицина (121-130)
    "Человек может чихать со скоростью 160 км/ч.",
    "Печень - единственный орган, способный полностью регенерировать.",
    "Ушная сера защищает уши от бактерий и грибков.",
    "Человек использует все части мозга, а не только 10%.",
    "Волосы человека могут выдержать вес до 100 грамм.",
    "Кости человека на 31% состоят из воды.",
    "Самый распространенный аллерген в мире - пыль.",
    "Нервные импульсы в теле движутся со скоростью до 120 м/с.",
    "Человек рождается с 300 костями, а умирает с 206.",
    "Женское сердце бьется быстрее мужского.",

    // Природа (131-140)
    "Деревья общаются через подземные грибковые сети.",
    "Один дуб может производить до 10 000 желудей за год.",
    "Баобаб может хранить до 120 000 литров воды в стволе.",
    "Бамбук может расти со скоростью до 1 метра в день.",
    "В Австралии есть растение, чьи листья могут весить до 20 кг.",
    "Самый большой живой организм на Земле - гриб в Орегоне площадью 8.9 км².",
    "Некоторые кактусы могут жить до 200 лет.",
    "В тропических лесах Амазонки каждые 5 минут открывают новый вид.",
    "Растения реагируют на звуки и могут 'слышать' воду.",
    "Самый старый живой организм - сосна в Калифорнии возрастом 5067 лет.",

    // Вода (141-150)
    "Человек может прожить без воды всего 3-5 дней.",
    "68.7% пресной воды на Земле находится в ледниках.",
    "Вода - единственное вещество, которое в твердом состоянии легче, чем в жидком.",
    "В стакане воды больше молекул, чем стаканов воды во всех океанах.",
    "Горячая вода замерзает быстрее холодной (эффект Мпембы).",
    "Вода покрывает 71% поверхности Земли, но только 1% пригоден для питья.",
    "Самое глубокое озеро - Байкал (1642 м).",
    "Вода составляет около 60% массы тела взрослого человека.",
    "В Антарктиде есть водопад цвета крови из-за высокого содержания железа.",
    "Вода может существовать в трех состояниях одновременно при определенных условиях.",

    // Музыка (151-160)
    "Музыка влияет на частоту сердечных сокращений.",
    "Самая длинная музыкальная пьеса длится 639 лет.",
    "Бетховен сочинял музыку, будучи полностью глухим.",
    "У людей, играющих на музыкальных инструментах, мозг работает иначе.",
    "Самый дорогой музыкальный инструмент - скрипка Страдивари.",
    "Музыка улучшает рост растений.",
    "В Швеции есть отель, где можно играть на музыкальных инструментах 24/7.",
    "Ноты были изобретены в 11 веке монахом Гвидо д'Ареццо.",
    "В Японии есть музыкальные дороги - при движении по ним играет мелодия.",
    "Самый большой орган в мире имеет 33 112 труб.",

    // Литература (161-170)
    "Самый длинный роман в мире - 'В поисках утраченного времени' (1.2 млн слов).",
    "Шекспир изобрел более 1700 слов английского языка.",
    "Первая книга, напечатанная на компьютере, была 'Алиса в Стране чудес'.",
    "В оригинале 'Золушка' теряла не хрустальную туфельку, а меховую.",
    "Дж.К. Роулинг стала первым миллиардером-писателем.",
    "Самая продаваемая книга в мире - Библия.",
    "В Японии есть кафе, где можно почитать книгу с котом на коленях.",
    "Первая энциклопедия была создана в Древнем Риме.",
    "В Норвегии государство покупает 1000 экземпляров каждой новой книги.",
    "'Дон Кихот' считается первым современным романом.",

    // Кино (171-180)
    "Первый цветной фильм был снят в 1902 году.",
    "'Унесенные ветром' - первый цветной фильм, получивший 'Оскар'.",
    "В фильме 'Криминальное чтиво' Джон Траволта моргает всего 3 раза.",
    "Самый дорогой фильм в истории - 'Мстители: Финал' ($356 млн).",
    "В оригинальном 'Кинг-Конге' (1933) использовали настоящих пауков.",
    "Альфред Хичкок никогда не выигрывал 'Оскар' за режиссуру.",
    "В 'Титанике' Джек мог поместиться на той двери вместе с Розой.",
    "Первый фильм с CGI был создан в 1973 году.",
    "'Звездные войны' изначально назывались 'Приключения Люка Старкиллера'.",
    "В 'Матрице' код на экранах - это рецепты суши.",

    // Технологии будущего (181-190)
    "К 2030 году может появиться квантовый интернет.",
    "Уже существуют бионические глаза, возвращающие зрение.",
    "Ученые работают над созданием искусственного фотосинтеза.",
    "В Японии тестируют лифты в космос.",
    "3D-печать органов для трансплантации - реальность ближайшего будущего.",
    "Искусственный интеллект уже пишет музыку и картины.",
    "В разработке - нанороботы для лечения рака.",
    "Умные контактные линзы смогут измерять уровень сахара в крови.",
    "В будущем могут появиться съедобные упаковки.",
    "Ученые работают над созданием вечной батареи.",

    // Необычные законы (191-200)
    "В Алабаме запрещено водить машину с завязанными глазами.",
    "В Сингапуре запрещено жевать жвачку (кроме лечебной).",
    "В Аризоне запрещено охотиться на верблюдов.",
    "В Дании водитель должен проверить, нет ли детей под машиной.",
    "В Англии запрещено умирать в здании парламента.",
    "В Огайо запрещено давать алкоголь рыбам.",
    "В Канаде запрещено расклеивать плакаты, изображающие комиксы.",
    "В Швейцарии запрещено спускать воду в туалете после 10 вечера.",
    "В Италии запрещено строить песочные замки на пляжах.",
    "В Теннесси запрещено продавать пустые гробы.",

    // Деньги (201-210)
    "Бумажные деньги сделаны не из бумаги, а из хлопка и льна.",
    "Самая крупная купюра в мире - 100 000 долларов (США, 1934).",
    "В Швеции меньше 1% операций проводится наличными.",
    "Первые кредитные карты появились в 1950 году.",
    "В Зимбабве была купюра в 100 триллионов долларов.",
    "Монету в 1 цент США дороже производить, чем она стоит.",
    "В Дании нет монет с числом '7'.",
    "В Канаде были пластиковые банкноты.",
    "В Австралии первые банкноты делали из коры деревьев.",
    "В США больше статуй свободы, чем в любой другой стране.",

    // Транспорт (211-220)
    "Первый автомобиль развивал скорость 16 км/ч.",
    "В Дубае есть автобусы с золотым покрытием.",
    "В Японии поезда опаздывают в среднем на 18 секунд.",
    "Первый светофор был установлен в Лондоне в 1868 году.",
    "В Норвегии есть туннель с круговыми развязками внутри.",
    "Самый длинный лифт в мире - в Китае (326 м).",
    "В Швейцарии есть поезд, который проходит через 4 страны за 2 часа.",
    "Первый парковочный счетчик установлен в 1935 году.",
    "В Амстердаме больше велосипедов, чем жителей.",
    "Самый большой самолет в мире - Ан-225 'Мрия'.",

    // Спортивные рекорды (221-230)
    "Самый длинный теннисный матч длился 11 часов 5 минут.",
    "Самая длинная серия побед в боксе - 229 боев (Джо Луис).",
    "Самый быстрый гол в футболе забит через 2 секунды после начала.",
    "Самая длинная серия побед в шахматах - 20 партий (Магнус Карлсен).",
    "Самый возрастной олимпийский чемпион - 72 года (стрельба).",
    "Самая длинная серия побед в NBA - 33 игры (Лейкерс).",
    "Самый быстрый мяч в бейсболе - 169 км/ч.",
    "Самая длинная серия побед в UFC - 16 боев (Андерсон Сильва).",
    "Самый возрастной марафонец - 101 год.",
    "Самая длинная партия в настольный теннис - 8 часов 40 минут.",

    // Искусственный интеллект (231-240)
    "ИИ уже обыгрывает людей в покер и го.",
    "Нейросети могут создавать реалистичные изображения несуществующих людей.",
    "В 2020 году ИИ написал статью для The Guardian.",
    "Алгоритмы предсказывают погоду точнее людей.",
    "ИИ помогает диагностировать рак с точностью до 99%.",
    "В Японии есть робот-гуманоид, который сдал экзамен в университет.",
    "ИИ может имитировать голос любого человека.",
    "Нейросети создают музыку в стиле умерших композиторов.",
    "В Китае ИИ ведет новостные передачи.",
    "Алгоритмы могут предсказывать землетрясения.",

    // Будущее человечества (241-250)
    "К 2050 году 75% населения будет жить в городах.",
    "Уже существуют прототипы летающих автомобилей.",
    "Ученые работают над цифровым бессмертием.",
    "В разработке - искусственная матка для вынашивания детей.",
    "К 2030 году может появиться первая база на Луне.",
    "Ведутся работы по созданию квантового компьютера.",
    "Уже тестируются мозговые импланты для улучшения памяти.",
    "В будущем могут появиться съедобные упаковки.",
    "Ученые работают над созданием вечной батареи.",
    "К 2100 году средняя продолжительность жизни может достичь 120 лет."
];
//рандом факт
function getRandomFact() {
    showTypingIndicator();

    setTimeout(() => {
        hideTypingIndicator();

        const randomIndex = Math.floor(Math.random() * localFacts.length);
        const fact = localFacts[randomIndex];

        const emojis = ["🔍", "🧠", "🌍", "🔬", "💡"];
        const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
        const formattedFact = `${randomEmoji} <strong>Факт:</strong> ${fact}`;

        addMessage(formattedFact, false);
    }, 800);
}
// Функция для вывода списка команд
function showHelp() {
  const helpDiv = document.createElement('div');
  helpDiv.classList.add('message', 'help-message', 'new-message');
  helpDiv.innerHTML = `
    <div class="help-title">📋 Доступные команды:</div>
    <div class="help-command"><strong>!help</strong> - показать список команд</div>
    <div class="help-command"><strong>!бросить кубик</strong> - бросить шестигранный кубик</div>
    <div class="help-command"><strong>!подбросить монетку</strong> - подбросить монетку (орёл/решка)</div>
    <div class="help-command"><strong>!тема</strong> - переключить светлую/темную тему</div>
    <div class="help-command"><strong>!глеб</strong> - Послать Глеба</div>
    <div class="help-command"><strong>!факт</strong> - Показать случайный интересный факт</div>
    <div class="help-command"><strong>!казик</strong> - Сыграть в казино</div>
    <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
  `;

  chatMessages.appendChild(helpDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;

  setTimeout(() => {
      helpDiv.classList.remove('new-message');
  }, 1500);
}

// Обработчик отправки сообщения
function sendMessage() {
  const message = messageInput.value.trim();
  if (message) {
    addMessage(message, true);
    messageInput.value = '';

    const lowerMessage = message.toLowerCase();
    const hasDiceCommand = lowerMessage.includes('!бросить кубик');
    const hasHelpCommand = lowerMessage.includes('!help') || lowerMessage.includes('!помощь');
    const hasThemeCommand = lowerMessage.includes('!тема');
    const hasCoinCommand = lowerMessage.includes('!подбросить монетку') || lowerMessage.includes('!монетка');
    const hasGlebCommand = lowerMessage.includes('!глеб');
    const hasCasinoCommand = lowerMessage.includes('!казик');
    const hasStatsCommand = lowerMessage.includes('!статистика');

    const isOnlyCommand = lowerMessage === '!бросить кубик' ||
                        lowerMessage === '!help' ||
                        lowerMessage === '!помощь' ||
                        lowerMessage === '!тема' ||
                        lowerMessage === '!подбросить монетку' ||
                        lowerMessage === '!монетка' ||
                        lowerMessage === '!глеб' ||
                        lowerMessage === '!факт' ||
                        lowerMessage === '!казик' ||
                        lowerMessage === '!статистика';

    if (hasGlebCommand) {
      handleGlebCommand();
      if (hasDiceCommand) setTimeout(() => rollDice(), 1000);
      if (hasHelpCommand) setTimeout(() => showHelp(), 1000);
      if (hasThemeCommand) setTimeout(() => toggleTheme(), 1000);
      if (hasCoinCommand) setTimeout(() => flipCoin(), 1000);
      if (lowerMessage === '!факт') setTimeout(() => getRandomFact(), 1000);
      if (hasCasinoCommand) setTimeout(() => createCasino(), 1000);
      if (hasStatsCommand) setTimeout(() => showStats(), 1000);
      return;
    }

    if (isOnlyCommand) {
      setTimeout(() => {
        if (lowerMessage === '!бросить кубик') {
          rollDice();
        } else if (hasHelpCommand) {
          showHelp();
        } else if (hasThemeCommand) {
          toggleTheme();
        } else if (hasCoinCommand) {
          flipCoin();
        } else if (lowerMessage === '!факт') {
          getRandomFact();
        } else if (hasCasinoCommand) {
          createCasino();
        } else if (hasStatsCommand) {
          showStats();
        }
      }, 800);
      return;
    }

    showTypingIndicator();

    setTimeout(() => {
      hideTypingIndicator();

      if (!isOnlyCommand) {
        const replies = [
          "Интересное сообщение...",
          "Я подумаю над этим.",
          "Ммм...",
          "Продолжай в том же духе!",
          "Хм, никогда об этом не задумывался."
        ];
        const randomReply = replies[Math.floor(Math.random() * replies.length)];
        addMessage(randomReply, false);
      }

      if (hasDiceCommand && !isOnlyCommand) setTimeout(() => rollDice(), 500);
      if (hasHelpCommand && !isOnlyCommand) setTimeout(() => showHelp(), 500);
      if (hasThemeCommand && !isOnlyCommand) setTimeout(() => addMessage("Используйте команду !тема отдельно для переключения темы", false), 500);
      if (hasCoinCommand && !isOnlyCommand) setTimeout(() => flipCoin(), 500);
      if (lowerMessage.includes('!факт') && !isOnlyCommand) setTimeout(() => getRandomFact(), 500);
      if (hasCasinoCommand && !isOnlyCommand) setTimeout(() => createCasino(), 500);
      if (hasStatsCommand && !isOnlyCommand) setTimeout(() => showStats(), 500);
    }, 1500 + Math.random() * 1000);
  }
}


// Показать индикатор набора сообщения
function showTypingIndicator() {
  let typingDiv = document.querySelector('.typing-indicator');
  if (!typingDiv) {
      typingDiv = document.createElement('div');
      typingDiv.classList.add('typing-indicator');
      typingDiv.innerHTML = 'Печатает <div class="typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';
      chatMessages.appendChild(typingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
  }
}

// Скрыть индикатор набора сообщения
function hideTypingIndicator() {
  const typingDiv = document.querySelector('.typing-indicator');
  if (typingDiv) {
      typingDiv.remove();
  }
}

// Переключение темы
function toggleTheme() {
  if (body.classList.contains('light-theme')) {
      body.classList.remove('light-theme');
      localStorage.setItem('chat-theme', 'dark-theme');
  } else {
      body.classList.add('light-theme');
      localStorage.setItem('chat-theme', 'light-theme');
  }
  updateThemeButton();
}

// События
sendButton.addEventListener('click', sendMessage);
messageInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
      sendMessage();
  }
});
themeToggle.addEventListener('click', toggleTheme);

// Инициализация
createParallax();

        // Приветственное сообщение
        setTimeout(() => {
            addMessage("Добро пожаловать в чат. Я - ваш виртуальный собеседник.", false);
        }, 800);

        // Пример сообщения с цензурой
        setTimeout(() => {
            addMessage("Попробуйте написать !help для вывода команд!", false);
        }, 2000);

        // Создаем бургер-меню с правильным отображением

      function createBurgerMenu() {
          // Создаем контейнер для всего ввода (меню + поле ввода + кнопка)
          const inputWrapper = document.createElement('div');
          inputWrapper.className = 'chat-input-wrapper';
          inputWrapper.style.cssText = `
              display: flex;
              align-items: center;
              width: 100%;
              gap: 8px;
          `;

          // Создаем контейнер для меню
          const menuContainer = document.createElement('div');
          menuContainer.className = 'burger-menu-container';
          menuContainer.style.cssText = `
              position: relative;
              flex-shrink: 0;
          `;

          // Остальной код создания меню остается без изменений
          const burgerButton = document.createElement('button');
          burgerButton.className = 'burger-button';
          burgerButton.innerHTML = `
              <span class="burger-line" style="background: var(--text-color)"></span>
              <span class="burger-line" style="background: var(--text-color)"></span>
              <span class="burger-line" style="background: var(--text-color)"></span>
          `;
          burgerButton.style.cssText = `
              background: var(--input-bg);
              border: none;
              border-radius: 50%;
              width: 44px;
              height: 44px;
              cursor: pointer;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              padding: 10px;
              transition: all 0.3s ease;
              position: relative;
              z-index: 1;
          `;

          const dropdownMenu = document.createElement('div');
          dropdownMenu.className = 'dropdown-menu';
          dropdownMenu.style.cssText = `
              position: absolute;
              bottom: calc(100% + 10px);
              left: 0;
              background: var(--message-bot);
              border-radius: 12px;
              padding: 8px 0;
              box-shadow: var(--chat-shadow);
              z-index: 1000;
              min-width: 220px;
              border: 1px solid var(--border-color);
              transform: translateY(10px);
              opacity: 0;
              visibility: hidden;
              transition: all 0.3s ease;
          `;

          // Команды для меню
          const commands = [
              { name: 'Помощь', command: '!help', icon: '❓' },
              { name: 'Бросить кубик', command: '!бросить кубик', icon: '🎲' },
              { name: 'Подбросить монетку', command: '!подбросить монетку', icon: '🪙' },
              { name: 'Переключить тему', command: '!тема', icon: '🌓' },
              { name: 'Послать Глеба', command: '!глеб', icon: '🥰' },
              { name: 'Случайный факт', command: '!факт', icon: '🔍' },
              { name: 'Казик', command: '!казик', icon: '🎰' },
              { name: 'Статистика', command: '!статистика', icon: '🎰' }

          ];

          commands.forEach((cmd, index) => {
              const menuItem = document.createElement('div');
              menuItem.className = 'menu-item';
              menuItem.innerHTML = `
                  <span class="menu-icon">${cmd.icon}</span>
                  <span class="menu-text">${cmd.name}</span>
              `;
              menuItem.style.cssText = `
                  padding: 10px 16px;
                  cursor: pointer;
                  color: var(--text-color);
                  display: flex;
                  align-items: center;
                  transition: all 0.2s ease;
                  border-radius: 6px;
                  margin: 0 8px;
              `;

              menuItem.addEventListener('mouseenter', () => {
                  menuItem.style.background = 'rgba(106, 27, 154, 0.15)';
              });

              menuItem.addEventListener('mouseleave', () => {
                  menuItem.style.background = 'transparent';
              });

              menuItem.addEventListener('click', () => {
                  messageInput.value = cmd.command;
                  sendMessage();
                  toggleMenu(false);
              });

              dropdownMenu.appendChild(menuItem);
          });

          function toggleMenu(show) {
              if (show) {
                  dropdownMenu.style.transform = 'translateY(0)';
                  dropdownMenu.style.opacity = '1';
                  dropdownMenu.style.visibility = 'visible';
                  const lines = burgerButton.querySelectorAll('.burger-line');
                  lines[0].style.transform = 'translateY(6px) rotate(45deg)';
                  lines[1].style.opacity = '0';
                  lines[2].style.transform = 'translateY(-6px) rotate(-45deg)';
              } else {
                  dropdownMenu.style.transform = 'translateY(10px)';
                  dropdownMenu.style.opacity = '0';
                  dropdownMenu.style.visibility = 'hidden';
                  const lines = burgerButton.querySelectorAll('.burger-line');
                  lines[0].style.transform = 'translateY(0) rotate(0)';
                  lines[1].style.opacity = '1';
                  lines[2].style.transform = 'translateY(0) rotate(0)';
              }
          }

          burgerButton.addEventListener('click', (e) => {
              e.stopPropagation();
              const isOpen = dropdownMenu.style.visibility === 'visible';
              toggleMenu(!isOpen);
          });

          document.addEventListener('click', (e) => {
              if (!menuContainer.contains(e.target)) {
                  toggleMenu(false);
              }
          });

          menuContainer.appendChild(burgerButton);
          menuContainer.appendChild(dropdownMenu);

          // Добавляем элементы в обертку
          inputWrapper.appendChild(menuContainer);
          inputWrapper.appendChild(messageInput);
          inputWrapper.appendChild(sendButton);

          // Заменяем содержимое chat-input
          const chatInput = document.querySelector('.chat-input');
          chatInput.innerHTML = '';
          chatInput.appendChild(inputWrapper);

          // Стили для адаптации
          const style = document.createElement('style');
          style.textContent = `
              .burger-line {
                  display: block;
                  width: 22px;
                  height: 2px;
                  background-color: var(--text-color);
                  margin: 3px 0;
                  transition: all 0.3s ease;
                  transform-origin: center;
              }

              .menu-icon {
                  margin-right: 12px;
                  font-size: 1.1em;
                  width: 20px;
                  text-align: center;
              }

              .menu-text {
                  flex: 1;
              }

              .burger-button:hover {
                  background: rgba(106, 27, 154, 0.2) !important;
              }

              .burger-button:active {
                  transform: scale(0.95);
              }

              .chat-input-wrapper {
                  display: flex;
                  align-items: center;
                  width: 100%;
                  gap: 8px;
              }

              #message-input {
                  flex: 1;
                  min-width: 0; /* Важно для правильного сжатия */
              }

              @media (max-width: 500px) {
                  .dropdown-menu {
                      right: 0;
                      left: auto;
                      min-width: 180px;
                  }

                  .chat-input-wrapper {
                      gap: 6px;
                  }

                  .burger-button {
                      width: 40px;
                      height: 40px;
                      padding: 8px;
                  }

                  #send-button {
                      width: 48px;
                      height: 48px;
                      margin-left: 0;
                  }
              }
          `;
          document.head.appendChild(style);
      }



// Функция для создания казино
function createCasino() {
  const casinoDiv = document.createElement('div');
  casinoDiv.classList.add('message', 'casino-message', 'new-message');
  casinoDiv.innerHTML = `
    <div class="casino-container">
      <div class="casino-header">🎰 Казино "Чач"</div>
      <div class="roulette-container">
        <div class="pointer"></div>
        <div class="roulette-wheel" id="roulette-wheel"></div>
        <button class="roulette-button" id="spin-button">Крутить</button>
      </div>
        <div class="roulette-result" id="result">Нажми "Крутить"</div>

    </div>
    <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
  `;

  chatMessages.appendChild(casinoDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;

  // Добавляем стили для казино
  const style = document.createElement('style');
  style.textContent = `
    .casino-container {
      background: var(--message-bot);
      border-radius: 12px;
      padding: 16px;
      margin: 8px 0;
      max-width: 100%;
      box-shadow: var(--chat-shadow);
    }
    .casino-header {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 12px;
      text-align: center;
      color: var(--text-color);
    }
    .roulette-container {
      position: relative;
      width: 250px;
      height: 250px;
      margin: 0 auto;
    }
    .roulette-wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
      transform: rotate(0deg);
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    .pointer {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 30px solid #ff0000;
      z-index: 10;
    }
    #result {
      margin-top: 40px;
      font-size: 24px;
      font-weight: bold;
      min-height: 60px;
      padding: 10px;
      border-radius: 5px;
      width: 80%;
      margin-left: auto;
      margin-right: auto;
      transition: all 0.3s;
      text-align: center;
    }
    .roulette-button {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent-color);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 8px 20px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: all 0.2s;
    }
    .roulette-button:hover {
      background: var(--accent-hover);
    }
    .roulette-button:active {
      transform: translateX(-50%) scale(0.95);
    }
    .stats-container {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .stat-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9em;
      color: var(--text-color);
    }
    .stat-color {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }
    @media (max-width: 400px) {
      .roulette-container {
        width: 200px;
        height: 200px;
      }
      .roulette-result {
        width: 60px;
        height: 60px;
        font-size: 0.8em;
      }
    }
  `;
  document.head.appendChild(style);

  // Инициализируем рулетку после добавления в DOM
  setTimeout(() => {
    const wheel = casinoDiv.querySelector('#roulette-wheel');
    const spinButton = casinoDiv.querySelector('#spin-button');
    const resultDisplay = casinoDiv.querySelector('#result');

    const displayedOutcomes = [
      { color: '#BEBEBE', text: 'Скам', name: 'Серый', textColor: '#fff', displayWeight: 75 },
      { color: '#2196F3', text: 'Удар по Глебу', name: 'Синий', textColor: '#fff', displayWeight: 10 },
      { color: '#9C27B0', text: 'Разрешение на фурри', name: 'Фиолетовый', textColor: '#fff', displayWeight: 6 },
      { color: '#f44336', text: 'Пожать руку Аляске', name: 'Красный', textColor: '#fff', displayWeight: 3 },
      { color: '#FFEB3B', text: 'НЮЮЮЮДСЫ ЭКСТРА ПУПА', name: 'Жёлтый', textColor: '#333', displayWeight: 1.5 }
    ];

    // Загружаем статистику из localStorage или создаем новую
    let stats = JSON.parse(localStorage.getItem('rouletteStats')) || {};
    if (Object.keys(stats).length === 0) {
      stats = {
        'Серый': 0,
        'Синий': 0,
        'Фиолетовый': 0,
        'Красный': 0,
        'Жёлтый': 0
      };
      localStorage.setItem('rouletteStats', JSON.stringify(stats));
    }

    // Функция для отображения статистики
    function showStats() {
      const statsDiv = document.createElement('div');
      statsDiv.classList.add('message', 'stats-message', 'new-message');
      
      let statsHTML = '<div class="stats-container">';
      for (const [name, count] of Object.entries(stats)) {
        const color = displayedOutcomes.find(o => o.name === name).color;
        statsHTML += `
          <div class="stat-item">
            <span class="stat-color" style="background: ${color}"></span>
            <span>${name}: ${count}</span>
          </div>
        `;
      }
      statsHTML += '</div>';
      
      statsDiv.innerHTML = `
        <div class="casino-container">
          <div class="casino-header">📊 Статистика казино</div>
          ${statsHTML}
        </div>
        <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
      `;
      
      chatMessages.appendChild(statsDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      setTimeout(() => {
        statsDiv.classList.remove('new-message');
      }, 1500);
    }

    const realOutcomes = displayedOutcomes.map(outcome => {
      if (outcome.name === 'Серый') {
        return { ...outcome, realWeight: outcome.displayWeight * 2 };
      }
      return { ...outcome, realWeight: outcome.displayWeight * 0.5 };
    });

    function createSectors() {
      const totalDisplayWeight = displayedOutcomes.reduce((sum, item) => sum + item.displayWeight, 0);
      const sectors = [];
      
      const grayParts = displayedOutcomes.find(o => o.name === 'Серый').displayWeight / (displayedOutcomes.length - 1);
      
      displayedOutcomes.filter(o => o.name !== 'Серый').forEach(color => {
        sectors.push({
          color: '#BEBEBE',
          text: 'Скам',
          name: 'Серый',
          textColor: '#fff',
          displayWeight: grayParts,
          realWeight: grayParts * 2
        });
        
        sectors.push({
          ...color,
          displayWeight: color.displayWeight,
          realWeight: color.displayWeight * 0.5
        });
      });
      
      let currentAngle = 0;
      return sectors.map(sector => {
        const angleSize = (sector.displayWeight / totalDisplayWeight) * 360;
        const result = {
          ...sector,
          angleStart: currentAngle,
          angleEnd: currentAngle + angleSize,
          safeAngleStart: currentAngle + 2,
          safeAngleEnd: currentAngle + angleSize - 2
        };
        currentAngle += angleSize;
        return result;
      });
    }

    const sectors = createSectors();
    
    function createWheelGradient() {
      const gradientStops = sectors.map(s => 
        `${s.color} ${s.angleStart}deg ${s.angleEnd}deg`
      ).join(', ');
      wheel.style.background = `conic-gradient(${gradientStops})`;
    }
    createWheelGradient();

    let isSpinning = false;
    let currentRotation = 0;

    function selectWeightedSector() {
      const totalRealWeight = sectors.reduce((sum, s) => sum + s.realWeight, 0);
      let random = Math.random() * totalRealWeight;
      
      for (const sector of sectors) {
        if (random < sector.realWeight) return sector;
        random -= sector.realWeight;
      }
      return sectors[0];
    }

    function isOnBorder(angle) {
      return sectors.some(s => 
        Math.abs(angle - s.angleStart) < 2 || 
        Math.abs(angle - s.angleEnd) < 2
      );
    }

    function findSafeAngle(targetAngle, selectedSector) {
      const normalizedAngle = ((targetAngle % 360) + 360) % 360;
      
      if (selectedSector.name === 'Жёлтый') {
        return targetAngle;
      }
      
      for (const sector of sectors) {
        if (normalizedAngle >= sector.safeAngleStart && normalizedAngle < sector.safeAngleEnd) {
          return targetAngle;
        }
      }
      
      return (targetAngle + 1) % 360;
    }

    function getSectorByAngle(angle) {
      const normalizedAngle = ((angle % 360) + 360) % 360;
      for (const s of sectors) {
        if (normalizedAngle >= s.angleStart && normalizedAngle < s.angleEnd) {
          return s;
        }
      }
      return sectors[0];
    }

    function resetWheelPosition() {
      wheel.style.transition = 'none';
      wheel.style.transform = `rotate(${-currentRotation}deg)`;
      void wheel.offsetWidth;
      wheel.style.transition = 'transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
    }

    spinButton.addEventListener('click', async () => {
      if (isSpinning) return;
      isSpinning = true;
      spinButton.disabled = true;
      resultDisplay.textContent = 'Крутим...';
      resultDisplay.style.backgroundColor = 'transparent';

      resetWheelPosition();

      const selectedSector = selectWeightedSector();
      let targetMiddleAngle = (selectedSector.angleStart + selectedSector.angleEnd) / 2;
      targetMiddleAngle = findSafeAngle(targetMiddleAngle, selectedSector);

      const fullRotations = 5 * 360;
      let targetRotation = currentRotation + fullRotations + (360 - targetMiddleAngle);

      wheel.style.transform = `rotate(${-targetRotation}deg)`;
      currentRotation = targetRotation % 360;

      await new Promise(resolve => setTimeout(resolve, 4000));

      const finalAngle = ((targetRotation % 360) + 360) % 360;
      
      if (selectedSector.name !== 'Жёлтый' && isOnBorder(finalAngle)) {
        const extraRotation = currentRotation + 15;
        wheel.style.transition = 'transform 0.5s ease-out';
        wheel.style.transform = `rotate(${-extraRotation}deg)`;
        currentRotation = extraRotation % 360;
        await new Promise(resolve => setTimeout(resolve, 500));
      }

      const finalSector = getSectorByAngle(currentRotation);
      
      resultDisplay.textContent = finalSector.text;
      resultDisplay.style.backgroundColor = finalSector.color;
      resultDisplay.style.color = finalSector.textColor;

      // Обновляем статистику
      stats[finalSector.name]++;
      localStorage.setItem('rouletteStats', JSON.stringify(stats));

      isSpinning = false;
      spinButton.disabled = false;
    });
  }, 0);


  setTimeout(() => {
    casinoDiv.classList.remove('new-message');
  }, 1500);
}
// МАССИВ С ФУРРИ БУБАМИ И ГЛЕБАМИ СУЙ ПУТИ СЮДА!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// Глобальная переменная для хранения ссылки на текущее сообщение статистики
let currentStatsMessage = null;

function showStats() {
  // Удаляем предыдущее сообщение статистики, если оно есть
  if (currentStatsMessage) {
    currentStatsMessage.remove();
    currentStatsMessage = null;
  }

  // Загружаем статистику или создаем новую, если ее нет
  let stats = JSON.parse(localStorage.getItem('rouletteStats'));
  if (!stats) {
    stats = {
      'Синий': 0,
      'Фиолетовый': 0,
      'Красный': 0,
      'Жёлтый': 0
    };
    localStorage.setItem('rouletteStats', JSON.stringify(stats));
  }

  // Загружаем историю гифок или создаем новую, если ее нет
  let gifHistory = JSON.parse(localStorage.getItem('gifHistory'));
  if (!gifHistory) {
    gifHistory = {
      'Синий': [],
      'Фиолетовый': [],
      'Красный': [],
      'Жёлтый': []
    };
    localStorage.setItem('gifHistory', JSON.stringify(gifHistory));
  }

  const displayedOutcomes = [
    { 
      color: '#2196F3', 
      text: 'Удар по Глебу', 
      name: 'Синий', 
      textColor: '#fff', 
      gifs: [
        'img/gleb1.gif',
        'img/gleb2.gif',
        'img/gleb3.gif',
        'img/gleb4.gif',
        'img/gleb5.gif',
        'img/gleb6.gif',
        'img/gleb7.gif',
        'img/gleb8.gif',
        'img/gleb9.gif',
        'img/gleb10.gif'
      ] 
    },
    { 
      color: '#9C27B0', 
      text: 'Разрешение на фурри', 
      name: 'Фиолетовый', 
      textColor: '#fff', 
      gifs: [
        'img/furry1.gif',
        'img/furry2.gif',
        'img/furry3.gif',
        'img/furry4.gif',
        'img/furry5.gif',
        'img/furry6.gif',
        'img/furry7.gif',
        'img/furry8.gif',
        'img/furym.gif'
      ] 
    },
    { 
      color: '#f44336', 
      text: 'Пожать руку Аляске', 
      name: 'Красный', 
      textColor: '#fff', 
      gifs: [
        'img/hand1.gif',
        'img/hand2.gif',
        'img/hand3.gif',
        'img/hand4.gif'
      ] 
    },
    { 
      color: '#FFEB3B', 
      text: 'НЮЮЮЮДСЫ ЭКСТРА ПУПА', 
      name: 'Жёлтый', 
      textColor: '#333', 
      gifs: [
        'img/buba1.gif',
        'img/buba2.gif'
      ] 
    }
  ];

  const statsDiv = document.createElement('div');
  statsDiv.classList.add('message', 'stats-message', 'new-message');
  
  let statsHTML = '<div class="stats-container">';
for (const outcome of displayedOutcomes) {
    const count = stats[outcome.name] || 0;
    
    // Всегда показываем кнопку, если есть хотя бы 1 выпадение
    const showButton = count > 0;
    
    statsHTML += `
      <div class="stat-item">
        <span class="stat-color" style="background: ${outcome.color}"></span>
        <span class="stat-count">${count}</span>
        ${showButton ? `<button class="show-gif-btn" data-outcome="${outcome.name}">🎁</button>` : ''}
      </div>
    `;
}
statsHTML += '</div>';

  
  statsDiv.innerHTML = `
    <div class="casino-container">
      <div class="casino-header">📊 Статистика казино</div>
      ${statsHTML}
      <div class="gif-info">(Гифки можно получать при наличии хотя бы 1 выпадения)</div>
    </div>
    <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
  `;
  
  // Сохраняем ссылку на текущее сообщение статистики
  currentStatsMessage = statsDiv;
  
  chatMessages.appendChild(statsDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  
  // Добавляем обработчики для кнопок показа гифок
  statsDiv.querySelectorAll('.show-gif-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const outcomeName = this.getAttribute('data-outcome');
        const outcome = displayedOutcomes.find(o => o.name === outcomeName);
        
        // Всегда показываем случайную гифку из доступных
        const randomGif = outcome.gifs[Math.floor(Math.random() * outcome.gifs.length)];
        showGif(randomGif, outcomeName);
        
        // Уменьшаем счетчик (но не ниже 0)
        stats[outcomeName] = Math.max(0, (stats[outcomeName] || 0) - 1);
        localStorage.setItem('rouletteStats', JSON.stringify(stats));
        
        // Обновляем статистику
        setTimeout(showStats, 1500);
    });
});
  
  setTimeout(() => {
    statsDiv.classList.remove('new-message');
  }, 1500);
}

function showGif(gifUrl, outcomeName) {
  const gifDiv = document.createElement('div');
  gifDiv.classList.add('message', 'gif-message', 'new-message');
  gifDiv.innerHTML = `
    <div class="casino-container">
      <div class="casino-header">🎉 Получена награда за ${outcomeName}!</div>
      <img src="${gifUrl}" class="reward-gif">
    </div>
    <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
  `;
  
  chatMessages.appendChild(gifDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  
  setTimeout(() => {
    gifDiv.classList.remove('new-message');
  }, 1500);
}

// Обновленные стили для статистики
const gifStyles = document.createElement('style');
gifStyles.textContent = `
  .stats-container {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
    margin-top: 10px;
  }
  .stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    position: relative;
    min-width: 60px;
    padding: 10px;
    background: rgba(0,0,0,0.1);
    border-radius: 10px;
  }
  .stat-color {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  .stat-count {
    font-weight: bold;
    font-size: 1em;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    min-width: 20px;
    text-align: center;
  }
  .show-gif-btn {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 25px;
    height: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--accent-color);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 0.9em;
    cursor: pointer;
    transition: all 0.2s;
    padding: 0;
    z-index: 10;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    border: 2px solid rgba(255,255,255,0.3);
  }
  .show-gif-btn:hover {
    background: var(--accent-dark);
    transform: scale(1.2) rotate(15deg);
    box-shadow: 0 3px 8px rgba(0,0,0,0.4);
  }
  .show-gif-btn:active {
    transform: scale(0.95);
  }
  .reward-gif {
    max-width: 100%;
    max-height: 300px;
    border-radius: 8px;
    margin: 5px auto;
    display: block;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
  }
  .gif-info {
    font-size: 0.8em;
    text-align: center;
    margin-top: 10px;
    color: var(--text-color);
    opacity: 0.7;
  }

  /* Для светлой темы */
  .light-theme .stat-item {
    background: rgba(0,0,0,0.05);
  }
  .light-theme .show-gif-btn {
    border: 2px solid rgba(0,0,0,0.1);
  }
`;

document.head.appendChild(gifStyles);
  


  // Инициализация бургер-меню
  function initBurgerMenu() {
      createBurgerMenu();
  }

  // Вызываем инициализацию после загрузки страницы
  window.addEventListener('DOMContentLoaded', initBurgerMenu);
    </script>
</body>
</html>
